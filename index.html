<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ADMISOFT</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.tailwindcss.min.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        admisoft: {
                            DEFAULT: '#4F46E5',
                            dark: '#4338CA'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 h-full">
    <div class="min-h-screen flex flex-col">
        <!-- Navbar -->
        <nav class="bg-white dark:bg-gray-800 shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 flex items-center">
                            <i class="fas fa-cube text-admisoft dark:text-admisoft-dark text-2xl mr-2"></i>
                            <span class="text-xl font-bold text-gray-900 dark:text-white">ADMISOFT</span>
                        </div>
                        <div class="hidden md:ml-6 md:flex md:space-x-8">
                            <!-- Navigation items -->
                            <a href="#" class="border-admisoft dark:border-admisoft-dark text-gray-900 dark:text-white inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Dashboard
                            </a>
                            <a href="category.html" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Category
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Color
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Customer
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Message
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Order
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Post
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Product
                            </a>
                            <a href="#" class="border-transparent text-gray-500 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500 hover:text-gray-700 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                                Service
                            </a>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="theme-toggle" type="button" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:block"></i>
                        </button>
                        <button onclick="window.open('https://www.admisoft.com', '_blank')" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" title="Visiter notre site web">
                            <i class="fas fa-eye text-admisoft dark:text-admisoft-dark"></i>
                        </button>
                        <div class="relative">
                            <img class="h-8 w-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Sidebar -->
            <div class="hidden md:flex md:flex-shrink-0">
                <div class="flex flex-col w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700">
                    <div class="h-0 flex-1 flex flex-col pt-5 pb-4 overflow-y-auto">
                        <nav class="flex-1 px-2 space-y-1">
                            <a href="#" class="bg-gray-100 dark:bg-gray-700 text-admisoft dark:text-admisoft-dark group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-tachometer-alt mr-3 flex-shrink-0"></i>
                                Dashboard
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-project-diagram mr-3 flex-shrink-0"></i>
                                Category-process
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-palette mr-3 flex-shrink-0"></i>
                                Color
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-users mr-3 flex-shrink-0"></i>
                                Customer
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-envelope mr-3 flex-shrink-0"></i>
                                Message
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-shopping-cart mr-3 flex-shrink-0"></i>
                                Order
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-newspaper mr-3 flex-shrink-0"></i>
                                Post
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-box-open mr-3 flex-shrink-0"></i>
                                Product
                            </a>
                            <a href="#" class="text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 group flex items-center px-2 py-2 text-sm font-medium rounded-md">
                                <i class="fas fa-concierge-bell mr-3 flex-shrink-0"></i>
                                Service
                            </a>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-auto focus:outline-none">
                <div class="py-6">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Dashboard</h1>
                    </div>
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                        <!-- Stats Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            <!-- Categories Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-indigo-50 dark:bg-gray-700 text-admisoft dark:text-admisoft-dark">
                                        <i class="fas fa-tags text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Catégories</h3>
                                        <p id="categories-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Products Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-blue-50 dark:bg-gray-700 text-blue-600 dark:text-blue-400">
                                        <i class="fas fa-boxes text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Produits</h3>
                                        <p id="products-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Customers Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-green-50 dark:bg-gray-700 text-green-600 dark:text-green-400">
                                        <i class="fas fa-users text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Clients</h3>
                                        <p id="customers-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Administrators Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-purple-50 dark:bg-gray-700 text-purple-600 dark:text-purple-400">
                                        <i class="fas fa-user-shield text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Administrateurs</h3>
                                        <p id="administrators-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Completed Orders Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-teal-50 dark:bg-gray-700 text-teal-600 dark:text-teal-400">
                                        <i class="fas fa-check-circle text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Commandes terminées</h3>
                                        <p id="completed-orders-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pending Orders Card -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full bg-yellow-50 dark:bg-gray-700 text-yellow-600 dark:text-yellow-400">
                                        <i class="fas fa-clock text-xl"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h3 class="text-lg font-medium text-gray-500 dark:text-gray-400">Commandes en attente</h3>
                                        <p id="pending-orders-count" class="text-2xl font-semibold text-gray-900 dark:text-white">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Orders Table -->
                        <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-8">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-lg font-medium text-gray-900 dark:text-white">Dernières commandes</h2>
                                <button class="px-4 py-2 bg-admisoft dark:bg-admisoft-dark text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-800 transition duration-300">
                                    Voir toutes
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table id="orders-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">ID</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Client</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Montant</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Statut</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="orders-table-body">
                                        <!-- Data will be loaded from API -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Charts Section -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                                <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Ventes mensuelles</h2>
                                <div class="h-64">
                                    <canvas id="sales-chart"></canvas>
                                </div>
                            </div>
                            <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6">
                                <h2 class="text-lg font-medium text-gray-900 dark:text-white mb-4">Répartition des produits</h2>
                                <div class="h-64">
                                    <canvas id="products-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.tailwindcss.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Dark mode toggle
        const themeToggleBtn = document.getElementById('theme-toggle');
        const html = document.documentElement;

        // Check for saved user preference or use system preference
        if (localStorage.getItem('color-theme') === 'dark' || (!localStorage.getItem('color-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
        } else {
            html.classList.remove('dark');
        }

        // Toggle theme
        themeToggleBtn.addEventListener('click', function() {
            html.classList.toggle('dark');
            localStorage.setItem('color-theme', html.classList.contains('dark') ? 'dark' : 'light');
        });

        // Fetch dashboard stats from API
        async function fetchDashboardStats() {
            try {
                const response = await fetch('http://localhost/admisoft/admin/index.php');
                
                if (!response.ok) {
                    throw new Error('Erreur de réseau');
                }
                
                const data = await response.json();
                
                // Update dashboard stats
                document.getElementById('categories-count').textContent = data.categories;
                document.getElementById('products-count').textContent = data.products;
                document.getElementById('customers-count').textContent = data.customers;
                document.getElementById('administrators-count').textContent = data.administrators;
                document.getElementById('completed-orders-count').textContent = data.completed_orders;
                document.getElementById('pending-orders-count').textContent = data.pending_orders;
                
                return data;
            } catch (error) {
                console.error('Erreur:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les données du dashboard',
                });
                return null;
            }
        }

        // Fetch orders data from API
        async function fetchOrdersData() {
            try {
                // In a real app, you would fetch from your orders API endpoint
                // For this example, we'll simulate an API response
                const response = await fetch('http://localhost/admisoft/admin/orders.php');
                
                if (!response.ok) {
                    throw new Error('Erreur de réseau');
                }
                
                const data = await response.json();
                
                // Populate orders table
                const ordersTableBody = document.getElementById('orders-table-body');
                ordersTableBody.innerHTML = '';
                
                data.forEach(order => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    const statusColor = order.status === 'Livré' ? 
                        'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 
                        'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${order.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.customer}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.amount}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${order.status}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex space-x-2">
                                <button class="p-1 text-blue-600 hover:text-blue-900 dark:hover:text-blue-400" title="Voir">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="p-1 text-green-600 hover:text-green-900 dark:hover:text-green-400" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="p-1 text-red-600 hover:text-red-900 dark:hover:text-red-400" title="Supprimer">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    ordersTableBody.appendChild(row);
                });
                
                return data;
            } catch (error) {
                console.error('Erreur:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les données des commandes',
                });
                return null;
            }
        }

        // Initialize DataTable and fetch all data
        $(document).ready(async function() {
            // Initialize DataTable
            $('#orders-table').DataTable({
                language: {
                    "sEmptyTable":     "Aucune donnée disponible dans le tableau",
                    "sInfo":           "Affichage de _START_ à _END_ sur _TOTAL_ entrées",
                    "sInfoEmpty":      "Affichage de 0 à 0 sur 0 entrées",
                    "sInfoFiltered":   "(filtré à partir de _MAX_ entrées totales)",
                    "sInfoPostFix":    "",
                    "sInfoThousands":  ",",
                    "sLengthMenu":     "Afficher _MENU_ entrées",
                    "sLoadingRecords": "Chargement...",
                    "sProcessing":     "Traitement...",
                    "sSearch":         "Rechercher:",
                    "sZeroRecords":    "Aucun enregistrement correspondant trouvé",
                    "oPaginate": {
                        "sFirst":    "Premier",
                        "sLast":     "Dernier",
                        "sNext":     "Suivant",
                        "sPrevious": "Précédent"
                    },
                    "oAria": {
                        "sSortAscending":  ": activer pour trier la colonne par ordre croissant",
                        "sSortDescending": ": activer pour trier la colonne par ordre décroissant"
                    }
                }
            });
            
            // Initialize charts
            const salesCtx = document.getElementById('sales-chart').getContext('2d');
            const salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
                    datasets: [{
                        label: 'Ventes 2023',
                        data: [1200, 1900, 1500, 2000, 2500, 2200, 3000, 2800, 3500, 4000, 3800, 4500],
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderColor: '#4F46E5',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#6B7280'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#E5E7EB'
                            },
                            ticks: {
                                color: '#6B7280'
                            }
                        },
                        x: {
                            grid: {
                                color: '#E5E7EB'
                            },
                            ticks: {
                                color: '#6B7280'
                            }
                        }
                    }
                }
            });
            
            const productsCtx = document.getElementById('products-chart').getContext('2d');
            const productsChart = new Chart(productsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Électronique', 'Vêtements', 'Alimentation', 'Maison', 'Sports'],
                    datasets: [{
                        data: [300, 150, 100, 200, 50],
                        backgroundColor: [
                            '#4F46E5',
                            '#10B981',
                            '#F59E0B',
                            '#EF4444',
                            '#3B82F6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#6B7280'
                            }
                        }
                    }
                }
            });
            
            // Fetch and display all data
            await fetchDashboardStats();
            await fetchOrdersData();
            
            // Show success notification
            Swal.fire({
                icon: 'success',
                title: 'Données chargées',
                text: 'Les données du dashboard ont été mises à jour avec succès',
                timer: 2000,
                showConfirmButton: false
            });
        });
    </script>
</body>
</html>
