<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <!-- ... (le reste du head reste identique) ... -->
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 h-full">
    <!-- ... (le reste du HTML reste identique jusqu'à la partie script) ... -->

    <script>
        // ... (les fonctions pour la sidebar et dark mode restent identiques) ...

        // Fetch dashboard stats from API
        async function fetchDashboardStats() {
            try {
                const response = await fetch('http://localhost/admisoft/admin/index.php', {
                    credentials: 'include' // Pour inclure les cookies si nécessaire
                });
                
                if (!response.ok) {
                    throw new Error('Erreur de réseau');
                }
                
                const data = await response.json();
                
                // Update dashboard stats avec les données de l'API
                document.getElementById('categories-count').textContent = data.categories;
                document.getElementById('products-count').textContent = data.products;
                document.getElementById('customers-count').textContent = data.customers;
                document.getElementById('administrators-count').textContent = data.administrators;
                document.getElementById('completed-orders-count').textContent = data.completed_orders;
                document.getElementById('pending-orders-count').textContent = data.pending_orders;
                
                return data;
            } catch (error) {
                console.error('Erreur:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les données du dashboard',
                });
                return null;
            }
        }

        // Fetch orders data from API
        async function fetchOrdersData() {
            try {
                // Ici vous devriez créer un endpoint spécifique pour les commandes
                // Par exemple: localhost/admisoft/admin/orders.php
                // Pour cet exemple, je simule des données
                const response = await fetch('http://localhost/admisoft/admin/index.php', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error('Erreur de réseau');
                }
                
                // Dans la réalité, vous devriez avoir un endpoint qui retourne les commandes
                // Je garde la simulation pour l'exemple
                const stats = await response.json();
                
                // Simuler des données de commandes basées sur les stats
                const data = [
                    {
                        id: '#ADM-' + (Math.floor(Math.random() * 900) + 100),
                        customer: 'Client ' + (Math.floor(Math.random() * 100) + 1),
                        date: new Date().toLocaleDateString('fr-FR'),
                        amount: '€' + (Math.floor(Math.random() * 500) + 50) + '.' + (Math.floor(Math.random() * 99)).toString().padStart(2, '0'),
                        status: Math.random() > 0.5 ? 'Livré' : 'En cours'
                    },
                    // Ajoutez plus de commandes simulées si nécessaire
                ];
                
                // Populate orders table
                const ordersTableBody = document.getElementById('orders-table-body');
                ordersTableBody.innerHTML = '';
                
                data.forEach(order => {
                    let statusColor, statusText;
                    
                    if (order.status === 'Livré') {
                        statusColor = 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
                        statusText = order.status;
                    } else if (order.status === 'En cours') {
                        statusColor = 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200';
                        statusText = order.status;
                    } else {
                        statusColor = 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
                        statusText = order.status;
                    }
                    
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-700';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">${order.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.customer}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">${order.amount}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusColor}">${statusText}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex space-x-2 justify-end">
                                <button class="p-1.5 rounded-md bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors duration-200" title="Voir">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="p-1.5 rounded-md bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors duration-200" title="Modifier">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="p-1.5 rounded-md bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/50 transition-colors duration-200" title="Supprimer">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    ordersTableBody.appendChild(row);
                });
                
                return data;
            } catch (error) {
                console.error('Erreur:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les données des commandes',
                });
                return null;
            }
        }

        // Initialize DataTable and fetch all data
        $(document).ready(async function() {
            // Initialize DataTable
            const dataTable = $('#orders-table').DataTable({
                // ... (configuration DataTable reste identique) ...
            });
            
            // Initialize charts
            // ... (configuration des graphiques reste identique) ...
            
            // Update last update time
            function updateLastUpdateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                document.getElementById('last-update').textContent = now.toLocaleDateString('fr-FR', options);
            }
            
            // Fetch and display all data
            await fetchDashboardStats();
            await fetchOrdersData();
            updateLastUpdateTime();
            
            // Show success notification
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
            
            Toast.fire({
                icon: 'success',
                title: 'Données mises à jour',
                background: '#0298e4',
                color: '#fff',
                iconColor: '#fff'
            });
        });
    </script>
</body>
</html>
